(function(j){var s=$.fn.hide;$.fn.hide=function(D,E){var C=s.apply(this,arguments);$(this).trigger("hide");return C};var c=$.fn.show;$.fn.show=function(D,E){var C=c.apply(this,arguments);$(this).trigger("show");return C};var t=$.fn.html;$.fn.html=function(C){var D=t.apply(this,arguments);$(this).trigger("show");$(this).trigger("html");return D};var o=$.fn.append;$.fn.append=function(){var C=o.apply(this,arguments);$(this).trigger("append");return C};var p=$.fn.prepend;$.fn.prepend=function(){var C=p.apply(this,arguments);$(this).trigger("prepend");return C};var r=$.fn.detach;$.fn.detach=function(){var D=$(this).parent();var C=r.apply(this,arguments);D.trigger("detach");return C};$.fn.extend({outerHtml:function(E){if(E){return this.each(function(){$(this).replaceWith(E)})}var D=$("<div></div>").append($(this).clone());var C=D.html();D.remove();return C}});XF=j.XF=j.XF||{};XF.start=function(C){C=C||{};XF.Settings=new XF.SettingsClass();XF.Cache=new XF.CacheClass();XF.Controller=new XF.ControllerClass();XF.Device=new XF.DeviceClass();XF.PageSwitcher=new XF.PageSwitcherClass();XF.Settings.bulkSet(C.settings);XF.Cache.init();C.device=C.device||{};XF.Device.init(C.device.types);C.router=C.router||{};w(C.router.routes,C.router.handlers);g();v();rootDOMObject=C.root;if(!rootDOMObject){rootDOMObject=$("body")}z(rootDOMObject)};var x=function(C,D){var E=m(this,C,D);E.extend=this.extend;return E};var e=function(){};var m=function(D,C,E){var F;if(C&&C.hasOwnProperty("constructor")){F=C.constructor}else{F=function(){return D.apply(this,arguments)}}_.extend(F,D);e.prototype=D.prototype;F.prototype=new e();if(C){_.extend(F.prototype,C)}if(E){_.extend(F,E)}F.prototype.constructor=F;F.__super__=D.prototype;return F};XF.Utils={};XF.Utils.AddressBar={};_.extend(XF.Utils.AddressBar,{isMobile:(/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase())),BODY_SCROLL_TOP:false,getScrollTop:function(){var D=j,C=document;return D.pageYOffset||C.compatMode==="CSS1Compat"&&C.documentElement.scrollTop||C.body.scrollTop||0},hide:function(){console.log("XF :: Utils :: AddressBar :: hide");var D=j;if(!location.hash&&XF.Utils.AddressBar.BODY_SCROLL_TOP!==false){D.scrollTo(0,XF.Utils.AddressBar.BODY_SCROLL_TOP===1?0:1)}if(this.isMobile){var C=document.documentElement.style;C.height="200%";C.overflow="visible";j.scrollTo(0,1);C.height=j.innerHeight+"px";return true}},hideOnLoad:function(){console.log("XF :: Utils :: AddressBar :: hideOnLoad");var D=j,C=D.document;if(!location.hash&&D.addEventListener){j.scrollTo(0,1);XF.Utils.AddressBar.BODY_SCROLL_TOP=1;bodycheck=setInterval(function(){if(C.body){clearInterval(bodycheck);XF.Utils.AddressBar.BODY_SCROLL_TOP=XF.Utils.AddressBar.getScrollTop();XF.Utils.AddressBar.hide()}},15);D.addEventListener("load",function(){setTimeout(function(){if(XF.Utils.AddressBar.getScrollTop()<20){XF.Utils.AddressBar.hide()}},0)})}}});XF.UIElements={};_.extend(XF.UIElements,{enhanceView:function(C){if(!C instanceof jQuery){C=$(C);if(!C instanceof jQuery){return}}_.each(XF.UIElements.enhancementList,function(E,D,F){C.find(E.selector).not("[data-skip-enhance=true]").each(function(){var G=false;_.each(XF.UIElements.enhanced.length,function(I,H,J){if(XF.UIElements.enhanced[i]===this){G=true}});if(!G&$(this).attr("data-skip-enhance")!="true"){XF.UIElements.enhanced.push(this);XF.UIElements[E.enhanceMethod](this)}})})},enhancementList:{button:{selector:"A[data-role=button], BUTTON, INPUT[type=submit], INPUT[type=reset], INPUT[type=button] [data-appearance=backbtn]",enhanceMethod:"enhanceButton"},textinput:{selector:"INPUT[type=text], INPUT[type=search], INPUT[type=tel], INPUT[type=url], INPUT[type=email], INPUT[type=password], INPUT[type=datetime], INPUT[type=date], INPUT[type=month], INPUT[type=week], INPUT[type=time], INPUT[type=datetime-local], INPUT[type=number], INPUT[type=color], TEXTAREA, INPUT[type=range], INPUT[type=search]",enhanceMethod:"enhanceTextInput"},checkboxRadio:{selector:"INPUT[type=checkbox], INPUT[type=radio]",enhanceMethod:"enhanceCheckboxRadio"},fieldset:{selector:"fieldset[data-role=controlgroup]",enhanceMethod:"enhanceFieldset"},list:{selector:"UL[data-role=listview], OL[data-role=listview]",enhanceMethod:"enhanceList"},scrollable:{selector:"[data-scrollable=true]",enhanceMethod:"enhanceScrollable"}},enhanced:[],enhanceButton:function(E){var G=$(E);if(!E||!G instanceof jQuery){return}if(G.attr("data-skip-enhance")=="true"){return}var C;var J;if(E.nodeName=="A"||E.nodeName=="BUTTON"){C=G.attr({"data-skip-enhance":true});J=G.html();G.html("")}else{if(E.nodeName=="INPUT"){C=$("<div></div>").append(G.clone().addClass("xf-input-hidden").attr({"data-skip-enhance":true}));G.outerHtml(C);J=G.attr("value")}else{return}}var D=G.attr("data-small")=="true"||G.attr("data-appearance")=="backbtn";C.addClass(D?"xf-button-small":"xf-button");if(G.attr("data-appearance")=="backbtn"){C.addClass("xf-button-back")}var I=G.attr("data-icon");if(G.attr("data-appearance")=="backbtn"){I="left"}if(I){var F=$("<span class=xf-icon></span>");F.addClass("xf-icon-"+I);if(D){F.addClass("xf-icon-small")}else{F.addClass("xf-icon-big")}var H=G.attr("data-iconpos")||"left";if(H!="left"&&H!="right"&&H!="top"&&H!="bottom"){H="left"}C.addClass("xf-iconpos-"+H);C.append(F)}if(J){var K=$("<span></span>").append(J);if(D||G.attr("data-appearance")=="backbtn"){K.addClass("xf-button-small-text")}else{K.addClass("xf-button-text")}C.append(K)}if(G.attr("data-special")=="true"){C.addClass("xf-button-special")}if(G.attr("data-alert")=="true"){C.addClass("xf-button-alert")}if(G.attr("data-alert")=="true"){C.addClass("xf-button-alert")}},enhanceTextInput:function(S){var aj=$(S);if(!S||!aj instanceof jQuery){return}if(aj.attr("data-skip-enhance")=="true"){return}aj.attr({"data-skip-enhance":true});aj.addClass("xf-input-text");var ao=(S.nodeName=="INPUT");var ae=aj.attr("type");if(ae=="search"){var ag=$('<input type="text"/>');var D={};_.each(S.attributes,function(ap){if(ap.name=="type"){return}D[ap.name]=ap.value});ag.attr(D);aj.outerHtml(ag);aj=ag;S=ag[0]}else{if(ae=="number"||ae=="range"){var E=aj.attr("min");var O=aj.attr("max");var Y=parseFloat(aj.attr("value"));var ad=parseFloat(aj.attr("step"))||1;var ag=$('<input type="text"/>');var D={};_.each(S.attributes,function(ap){if(ap.name=="type"){return}D[ap.name]=ap.value});ag.attr(D);ag.attr({"data-skip-enhance":true});var W=$("<div></div>").addClass("xf-input-number");W.append($('<button type="button"></button>').addClass("xf-input-number-control xf-input-number-control-decrease").attr({"data-skip-enhance":true}).append($("<span></span>").addClass("xf-icon xf-icon-big xf-icon-minus-circled")));W.append(ag);W.append($('<button type="button"></button>').addClass("xf-input-number-control xf-input-number-control-increase").attr({"data-skip-enhance":true}).append($("<span></span>").addClass("xf-icon xf-icon-big xf-icon-plus-circled")));var ai=null;if(ae=="number"){aj.outerHtml(W);aj=W;S=W[0]}else{if(ae=="range"){ai=$("<div></div>").addClass("xf-range");ai.append(W);if((E||E===0)&&(O||O===0)){E=parseFloat(E);O=parseFloat(O);var ab=(Y-E)*100/(O-E);ai.append($("<div></div>").addClass("xf-input-range").append($("<div></div>").addClass("xf-range-wrap").append($("<div></div>").addClass("xf-input-range-min").html(E)).append($("<div></div>").addClass("xf-input-range-slider").append($("<div></div>").addClass("xf-input-range-track").append($("<div></div>").addClass("xf-input-range-value").css({width:""+ab+"%"}).append($("<div></div>").addClass("xf-input-range-control").attr({tabindex:"0"}).append($("<div></div>").addClass("xf-input-range-thumb").attr({title:""+Y}).css({left:""+100+"%"})))))).append($("<div></div>").addClass("xf-input-range-max").html(O)))).append($("<div></div>").addClass("xf-slider"));aj.outerHtml(ai);aj=ai;S=ai[0]}}}var am=function(ar){var aq=ar%ad;var at=ar-aq;if(aq>ad/2){at+=ad}ar=at;if((O||O===0)&&ar>O){ar=O}if((E||E===0)&&ar<E){ar=E}Y=ar;ag.attr({value:ar});if(ai){ai.find("div.xf-input-range-thumb").attr({title:ar});var ap=(ar-E)*100/(O-E);ai.find("div.xf-input-range-value").css({width:""+ap+"%"})}};var J=function(){var ap=parseFloat(ag.attr("value"));ap+=ad;am(ap)};var al=function(){var ap=parseFloat(ag.attr("value"));ap-=ad;am(ap)};W.find("button.xf-input-number-control-decrease").click(al);W.find("button.xf-input-number-control-increase").click(J);var V=ag.attr("value");var F;var U=function(ap){F=ag.attr("value");if(V==F){return}F=parseFloat(F);if(isNaN(F)){F=E}V=F;am(F)};ag.change(U).focus(U).focusout(U);if(ai){var K=undefined;var ak;var R;var Q;var af;var aa;var M=function(ap){if(!K){K=ai.find("div.xf-input-range-track")[0].clientWidth}return(ap/K*(O-E))};var I=function(ap){return(M(ap)+E)};var an=function(){Q=event.pageX||event.clientX||layerX||event.screenX;ak=Y;$(document).bind("mouseup",X);$(document).bind("mousemove",T)};var T=function(){af=event.pageX||event.clientX||layerX||event.screenX;aa=af-Q;R=M(aa);Q=af;ak+=R;am(ak)};var X=function(){$(document).unbind("mouseup",X);$(document).unbind("mousemove",T)};var P=function(){$(document).bind("keydown",ac)};var ac=function(ap){switch(ap.keyCode){case 33:am(Y+3*ad);break;case 34:am(Y-3*ad);break;case 35:am(O);break;case 36:am(E);break;case 38:case 39:am(Y+ad);break;case 37:case 40:am(Y-ad);break}};var H=function(){$(document).unbind("keydown",ac)};ai.find("div.xf-input-range-thumb").bind("mousedown",an);ai.find("div.xf-input-range-control").bind("focus",P).bind("focusout",H);var G=function(ap){if(ap.target==ai.find("div.xf-input-range-thumb")[0]){return}am(I(ap.offsetX))};ai.find("div.xf-input-range-track").bind("click",G)}}}var ah=false;if(aj.attr("data-appearance")=="split"&&ao){var C=["text","search","tel","url","email","password","datetime","date","month","week","time","datetime-local","color"];_.each(C,function(ap){if(ae==ap){ah=true}})}var L=aj.attr("id");var N=$("label[for="+L+"]");if(N.length){if(ah){aj.removeClass("xf-input-text").addClass("xf-input-split-input");N.addClass("xf-input-split-label");var Z=$("<div></div>").addClass("xf-input-split");Z.append($("<div></div>").addClass("xf-grid-unit xf-input-split-part1").append(N));Z.append($("<div></div>").addClass("xf-grid-unit xf-input-split-part2").append(aj.clone()));aj.outerHtml(Z);aj=Z;S=Z[0]}else{N.addClass("xf-label")}}},enhanceCheckboxRadio:function(G){var E=$(G);if(!G||!E instanceof jQuery){return}if(E.attr("data-skip-enhance")=="true"){return}E.attr({"data-skip-enhance":true});var D=E.attr("id");var H=$("label[for="+D+"]");if(H.length){var F=E.attr("type").toLowerCase();var C=E.attr("data-role")=="switch";var I=$("<div></div>");if(!C){I.addClass("xf-input-"+F);I.append($("<label></label>").addClass("xf-input-positioner").attr({"for":D}).append(E.clone()));I.append(H.addClass("xf-input-label"))}else{I.addClass("xf-switch");I.append($('<label class="xf-switch-control"></label>').attr({"for":D}).append(E.clone()).append($("<span class=xf-switch-track><span class=xf-switch-track-wrap><span class=xf-switch-thumb></span></span></span>")));I.append(H.addClass("xf-switch-label"))}E.outerHtml(I)}},enhanceFieldset:function(C){var G=$(C);if(!C||!G instanceof jQuery){return}if(G.attr("data-skip-enhance")=="true"){return}G.attr({"data-skip-enhance":true});G.addClass("xf-controlgroup");var E=G.children("legend").detach();G.wrapInner("<div class=xf-controlgroup-controls>");G.prepend(E);if(E.length){var F=$("<div></div>");var D={};_.each(E[0].attributes,function(H){D[H.name]=H.value});F.attr(D);F.addClass("xf-label");F.html(E.html());E.outerHtml(F.outerHtml())}},enhanceList:function(F){var C=$(F);if(!F||!C instanceof jQuery){return}if(C.attr("data-skip-enhance")=="true"){return}C.attr({"data-skip-enhance":true});C.addClass("xf-listview");if(C.attr("data-fullwidth")=="true"){C.addClass("xf-listview-fullwidth")}C.children("li").addClass("xf-li");C.children("li[data-role=divider]").addClass("xf-li-divider");var D=C.children("li");var E=D.children("a");E.addClass("xf-li-btn");D.not(E.parent()).not("[data-role=divider]").addClass("xf-li-static");C.children("li[data-icon]").children("a").each(function(){var I=$(this);var H=I.parent().attr("data-icon");I.append($("<span></span>").addClass("xf-icon xf-icon-big xf-icon-"+H));var G=I.parent().attr("data-iconpos");if(G!="left"&&G!="right"){G="right"}I.addClass("xf-li-with-icon-"+G)});E.children(".xf-count-bubble").parent().addClass("xf-li-has-count");E.children("img").parent().each(function(){var G=$(this);var H=G.parent().attr("data-thumbpos");if(H!="right"&&H!="left"){H="left"}G.addClass("xf-li-with-thumb-"+H);G.children("img").addClass("xf-li-thumb xf-li-thumb-"+H)});E.each(function(){var G=$(this);G.append($("<div class=xf-btn-text></div>").append(G.contents().not(".xf-icon, .xf-count-bubble, .xf-li-thumb")))});D.find("h1, h2, h3, h4, h5, h6").addClass("xf-li-header");D.find("p").addClass("xf-li-desc");D.filter(".xf-li-static").each(function(){$(this).wrapInner("<div class=xf-li-wrap />")})},enhanceScrollable:function(G){var C=$(G);if(!G||!C instanceof jQuery){return}if(C.attr("data-skip-enhance")=="true"){return}C.attr({"data-skip-enhance":true});var D=C.children();if(D.length==1&&false){D.addClass("xf-scrollable-content")}else{C.append($("<div></div>").addClass("xf-scrollable-content").append(D))}var H=C.attr("id");if(!H||H==""){H="xf_scrollable_"+new Date().getTime();C.attr({id:H})}var E=C.data("iscroll",new iScroll(H));var K=false;var J=function(){if(K){K=false;E.data("iscroll").refresh();I()}};var F=function(){if(jQuery.contains($("#"+H)[0],this)){K=true;setTimeout(J,100)}};var I=function(){$("#"+H+" *").bind("detach",F).bind("hide",F).bind("show",F).bind("append",F).bind("prepend",F).bind("html",F).bind("resize",F)};I()},createButton:function(C){var E=$("<button></button>");E.html(C.text);var D={};if(C.icon&&C.icon!=""){D["data-icon"]=C.icon}if(C.iconpos&&C.iconpos!=""){D["data-iconpos"]=C.iconpos}if(C.small&&C.small!=""){D["data-small"]=C.small}if(C.appearance&&C.appearance!=""){D["data-appearance"]=C.appearance}if(C.special&&C.special!=""){D["data-special"]=C.special}if(C.alert&&C.alert!=""){D["data-alert"]=C.alert}if(_.isFunction(C.handler)){E.click(C.handler)}E.attr(D);XF.UIElements.enhanceButton(E[0]);return E},createPopup:function(){var C=$('<div class="xf-dialog "><div class="xf-dialog-content"></div></div>');return C},showDialog:function(D,F,E){var C=XF.UIElements.createDialog(D,F,E);XF.UIElements.showPopup(C)},showPopup:function(C){XF.Device.getViewport().append(C)},hidePopup:function(C){C.detach()},createDialog:function(D,I,F){var E=XF.UIElements.createPopup();E.find(".xf-dialog-content").append($("<div></div>").addClass("xf-dialog-box").append($("<div></div>").addClass("xf-dialog-box-header").append($("<h3></h3>").html(D))).append($("<div></div>").addClass("xf-dialog-box-content").html(I)).append($("<div></div>").addClass("xf-dialog-box-footer clearfix")));var H=E.find(".xf-dialog-box-footer");if(!F){F=[{text:"OK",handler:function(){XF.UIElements.hidePopup(E)}}]}if(F){var G=F.length;var C;_.each(F,function(K,J,L){if(K instanceof jQuery){C=K}else{C=XF.UIElements.createButton(K)}H.append($("<div></div>").addClass("xf-grid-unit xf-grid-unit-1of"+G).append(C))})}XF.UIElements.dialog=E;return E},createNotification:function(D,E){var C=XF.UIElements.createPopup().addClass("xf-dialog-notification");C.find(".xf-dialog-content").append($("<div></div>").addClass("xf-notification").append($("<div></div>").addClass("xf-notification-wrap").append($("<div></div>").addClass("xf-notification-text").html(D))));if(E&&E!=""){C.find(".xf-notification-wrap").prepend($("<div></div>").addClass("xf-notification-icon").append($("<span></span>").addClass("xf-icon xf-icon-xl xf-icon-"+E)))}return C},loadingNotification:null,dialog:null,setLoadingNotification:function(C){XF.UIElements.loadingNotification=C},showLoading:function(D,C){if(D||C){if(XF.UIElements.loadingNotification){XF.UIElements.hideLoading()}XF.UIElements.setLoadingNotification(XF.UIElements.createNotification(D,C))}if(!XF.UIElements.loadingNotification){XF.UIElements.setLoadingNotification(XF.UIElements.createNotification("Loading..."))}XF.UIElements.showPopup(XF.UIElements.loadingNotification)},hideLoading:function(){if(XF.UIElements.loadingNotification){XF.UIElements.hidePopup(XF.UIElements.loadingNotification)}},hideDialog:function(){if(XF.UIElements.dialog){XF.UIElements.hidePopup(XF.UIElements.dialog)}}});var w=function(C,D){C=C||{};D=D||{};if(XF.Router){throw"XF.createRouter can be called only ONCE!"}else{XF.Router=new XF.RouterClass(C,D)}};var g=function(){$("[data-href]").live("click",function(){XF.Router.navigate($(this).attr("data-href"),true);_.delay(function(){j.scrollTo(0,0)},250)})};var z=function(C){$(C).find("[data-component]:visible, [data-component][data-cache=true]").each(function(G,F){var D=$(F).attr("data-id");var E=$(F).attr("data-component");f(D,E,true)})};var f=function(C,D){u(D,function(E){if(!n[C]){var F=new E(D,C);console.log("XF :: loadChildComponent - created : "+C);n[C]=F;F.construct()}})};var v=function(){$("[data-component]").live("show",function(C){if(C.currentTarget==C.target){var D=$(this).attr("data-id");if(!n[D]){var E=$(this).attr("data-component");f(D,E)}XF.UIElements.enhanceView($(this))}})};var l=function(D,E){var C=document.createElement("script");if(C.readyState){C.onreadystatechange=function(){if(C.readyState=="loaded"||C.readyState=="complete"){C.onreadystatechange=null;if(E){E()}}}}else{C.onload=function(){if(E){E()}}}C.src=D;document.getElementsByTagName("head")[0].appendChild(C)};var n={};var b={};var u=function(D,E){var C=b[D];if(!C){C=XF.registerComponent(D,XF.Settings.property("componentUrlFormatter")(D))}if(C.loaded){E(C.compDef);return}C.callbacks.push(E);if(!C.loading){C.loading=true;l(C.compSrc)}};XF.getComponentByID=function(C){return n[C]};XF.registerComponent=function(D,E){var C=b[D];if(C){return C}b[D]=new a(E);return b[D]};XF.defineComponent=function(D,E){var C=b[D];if(!C){C=b[D]=new a(null)}b[D].loading=false;b[D].loaded=true;b[D].compDef=E;while(C.callbacks.length){C.callbacks.pop()(C.compDef)}};XF.requireComponent=function(C,D){u(C,D)};var y={};XF.setOptionsByID=function(D,C){y[D]=C};var B=function(C){return y[C]||{}};XF.Events={};_.extend(XF.Events,{bind:function(E,G,D){var C=this._callbacks||(this._callbacks={});var F=C[E]||(C[E]=[]);F.push([G,D]);return this},unbind:function(F,H){var E;if(!F){this._callbacks={}}else{if(E=this._callbacks){if(!H){E[F]=[]}else{var G=E[F];if(!G){return this}for(var D=0,C=G.length;D<C;D++){if(G[D]&&H===G[D][0]){G[D]=null;break}}}}}return this},trigger:function(E){var F,K,I,J,G;var H=2;if(!(K=this._callbacks)){return this}while(H--){I=H?"all":E;if(F=K[I]){for(var D=0,C=F.length;D<C;D++){if(!(J=F[D])){F.splice(D,1);D--;C--}else{G=H?arguments:Array.prototype.slice.call(arguments,1);J[0].apply(J[1]||this,G)}}}}return this}});XF.history=null;XF.HistoryClass=function(){this.handlers=[];this.historyStarted=false;_.bindAll(this,"checkUrl")};var q=/^#*/;var k=/msie [\w.]+/;_.extend(XF.HistoryClass.prototype,{interval:50,prevFragment:"",getFragment:function(D,C){if(D==null){if(this._hasPushState||C){D=j.location.pathname;var E=j.location.search;if(E){D+=E}if(D.indexOf(this.options.root)==0){D=D.substr(this.options.root.length)}}else{D=j.location.hash}}return decodeURIComponent(D.replace(q,""))},start:function(E){if(this.historyStarted){throw new Error("XF.History has already been started")}this.options=_.extend({},{root:"/"},this.options,E);this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&j.history&&j.history.pushState);var D=this.getFragment();var C=document.documentMode;var G=(k.exec(navigator.userAgent.toLowerCase())&&(!C||C<=7));if(G){this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(D)}if(this._hasPushState){$(j).bind("popstate",this.checkUrl)}else{if("onhashchange" in j&&!G){$(j).bind("hashchange",this.checkUrl)}else{setInterval(this.checkUrl,this.interval)}}this.fragment=D;this.historyStarted=true;var H=j.location;var F=H.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!F){this.fragment=this.getFragment(null,true);j.location.replace(this.options.root+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&F&&H.hash){this.fragment=H.hash.replace(q,"");j.history.replaceState({},document.title,H.protocol+"//"+H.host+this.options.root+this.fragment)}}if(!this.options.silent){return this.loadUrl()}},route:function(C,D){this.handlers.unshift({route:C,callback:D})},checkUrl:function(D){var C=this.getFragment();if(C==this.fragment&&this.iframe){C=this.getFragment(this.iframe.location.hash)}if(C==this.fragment||C==decodeURIComponent(this.fragment)){return false}if(this.iframe){this.navigate(C)}this.loadUrl()||this.loadUrl(j.location.hash)},loadUrl:function(E){var D=this.fragment=this.getFragment(E);var C=_.any(this.handlers,function(F){if(F.route.test(D)){F.callback(D);return true}});XF.Utils.AddressBar.hide();XF.Utils.AddressBar.hideOnLoad();return C},navigate:function(C,D){var F=(C||"").replace(q,"");if(this.fragment==F||this.fragment==decodeURIComponent(F)){return}if(this._hasPushState){var E=j.location;if(F.indexOf(this.options.root)!=0){F=this.options.root+F}this.fragment=F;j.history.pushState({},document.title,E.protocol+"//"+E.host+F)}else{j.location.hash=this.fragment=F;if(this.iframe&&(F!=this.getFragment(this.iframe.location.hash))){this.iframe.document.open().close();this.iframe.location.hash=F}}if(D){this.loadUrl(C)}},goBack:function(){if(j.history&&j.history.back instanceof Function){j.history.back();XF.Utils.AddressBar.hide();XF.Utils.AddressBar.hideOnLoad()}}});XF.Settings=null;XF.SettingsClass=function(C){this.options={applicationVersion:"1.0.0",noCache:false,componentUrlPrefix:"",componentUrlPostfix:".js",componentUrlFormatter:function(D){return XF.Settings.property("componentUrlPrefix")+D+XF.Settings.property("componentUrlPostfix")},templateUrlPrefix:"",templateUrlPostfix:".tmpl",templateUrlFormatter:function(D,E){return XF.Settings.property("templateUrlPrefix")+E+D+XF.Settings.property("templateUrlPostfix")},dataUrlPrefix:"",dataUrlPostfix:".json",dataUrlFormatter:function(D){return XF.Settings.property("dataUrlPrefix")+D+XF.Settings.property("dataUrlPostfix")},touchableSwipeLength:100,touchableDoubleTapInterval:700,touchableLongTapInterval:500}};_.extend(XF.SettingsClass.prototype,{bulkSet:function(C){_.extend(this.options,C)},getProperty:function(C){return this.options[C]},setProperty:function(D,C){this.options[D]=C},property:function(D,C){if(C===undefined){return this.getProperty(D)}else{this.setProperty(D,C)}}});XF.Cache=null;XF.CacheClass=function(){this.storage=null;this.available=false};_.extend(XF.CacheClass.prototype,{init:function(){this.storage=j.localStorage;try{this.storage.setItem("check","check");this.storage.removeItem("check");this.available=true}catch(D){this.available=false}var C=this.get("applicationVersion");if(XF.Settings.property("noCache")){console.log("XF.Cache :: init - cache is disable for the whole app manually - clearing storage");this.clear();this.set("applicationVersion",XF.Settings.property("applicationVersion"))}else{if(C&&C==XF.Settings.property("applicationVersion")){console.log("XF.Cache :: init - same version is cached - useing it as much as possible")}else{console.log("XF.Cache :: init - wrong or no version cached - clearing storage");this.clear();this.set("applicationVersion",XF.Settings.property("applicationVersion"))}}},get:function(D){var C;if(this.available){try{C=this.storage.getItem(D);console.log('XF.Cache :: get - "'+D+'" = "'+C+'"')}catch(E){C=null}}else{C=null}return C},set:function(D,E){var C;if(this.available){try{this.storage.setItem(D,E);C=true;console.log('XF.Cache :: set - "'+D+'" = "'+E+'"')}catch(F){C=false}}else{C=false}return C},clear:function(){var C;if(this.available){try{this.storage.clear();C=true;console.log("XF.Cache :: clear")}catch(D){C=false}}else{C=false}return C}});XF.Controller=null;XF.ControllerClass=function(){};_.extend(XF.ControllerClass.prototype,XF.Events);XF.Router=null;XF.RouterClass=function(C,D){this.routes=C||{};this.handlers=D||{};this.mostRecentCalled=null;this.initialize()};var h=/:([\w\d]+)/g;var A=/\*([\w\d]+)/g;var d=/[-[\]{}()+?.,\\^$|#\s]/g;_.extend(XF.RouterClass.prototype,XF.Events,{route:function(C,D,E){XF.history||(XF.history=new XF.HistoryClass);if(!_.isRegExp(C)){C=this.routeToRegExp(C)}XF.history.route(C,_.bind(function(G){var F=this.extractParameters(C,G);E.apply(this,F);this.trigger.apply(this,["route:"+D].concat(F))},this))},navigate:function(C,D){XF.history.navigate(C,D)},routeToRegExp:function(C){C=C.replace(d,"\\$&").replace(h,"([^/]*)").replace(A,"(.*?)");return new RegExp("^"+C+"$")},extractParameters:function(C,D){return C.exec(D).slice(1)},initialize:function(){var C=this;this.route(new RegExp(".*","g"),"notFound",function(){var D=C.notFound;if(D){D.apply(C)}});$.each(this.routes,function(F,D){var E=function(){var G=C.handlers[D];if(G){G.apply(C.handlers,arguments)}C.mostRecentCalled={name:D,args:arguments}};C.route(F,D,E)})},start:function(){XF.history.start()},bindRoute:function(C,D){this.bind("route:"+C,D);if(this.mostRecentCalled&&this.mostRecentCalled.name==C){D(this.mostRecentCalled.args)}},bindAnyRoute:function(C){this.bind("all",C);if(this.mostRecentCalled){C(this.mostRecentCalled.name)}},getRouteByEventName:function(C){return C.replace("route:","")}});XF.RouterClass.extend=x;XF.Component=function(D,G){this.name=D||"default_name";this.id=G||"default_id";this.rendered=false;var F=function(){this.unbind("refresh",F);this.rendered=true};this.bind("refresh",F);var C=this.options;var E=B(this.id);this.options=_.defaults(E,C)};XF.Component.template=null;XF.Component.templateURL=false;XF.Component.templateLoaded=false;XF.Component.templateLoading=false;XF.Component.compiledTemplate=null;_.extend(XF.Component.prototype,XF.Events);_.extend(XF.Component.prototype,{options:{},modelClass:XF.Model,model:null,viewClass:XF.View,view:null,construct:function(){var D=function(){this.view.unbind("construct",D);this.afterConstructView();this.init();this.trigger("init");this.trigger("construct");XF.Controller.trigger(this.id+":constructed")};var C=function(){this.model.unbind("construct",C);this.afterConstructModel();this.beforeConstructView();this.constructView();this.view.bind("construct",D,this);this.view.construct()};this.beforeConstructModel();this.constructModel();this.model.bind("construct",C,this);this.model.construct();this.childComponent=[]},selector:function(){return"[data-id="+this.id+"]"},beforeConstructView:function(){},constructView:function(){if(!this.view||!(this.view instanceof XF.View)){if(this.viewClass){this.view=new this.viewClass();if(!(this.view instanceof XF.View)){this.view=new XF.View()}}else{this.view=new XF.View()}}this.view.component=this},afterConstructView:function(){},beforeConstructModel:function(){},constructModel:function(){if(!this.model||!(this.model instanceof XF.Model)){if(this.modelClass){this.model=new this.modelClass();if(!(this.model instanceof XF.Model)){this.model=new XF.Model()}}else{this.model=new XF.Model()}}this.model.component=this},afterConstructModel:function(){},init:function(){this.refresh()},refresh:function(){var C=function(){this.model.unbind("refresh",C);this.view.refresh();this.trigger("refresh")};this.model.bind("refresh",C,this);this.model.refresh()},ready:function(D){if(this.rendered){D()}else{var C=function(){this.unbind("refresh",C);D()};this.bind("refresh",C,this)}}});XF.Component.extend=x;var a=function(C){this.compSrc=C;this.compDef=null;this.loading=false;this.loaded=false;this.callbacks=[]};XF.Model=function(C){this.component=null;this.rawData=null;this.attributes={};this._previousAttributes={};this._changed=false;C||(C={});var D=this.defaults;if(D){if(_.isFunction(D)){D=D.call(this)}C=_.extend({},D,C)}this.set(C,{silent:true});this._changed=false;this._previousAttributes=_.clone(this.attributes)};_.extend(XF.Model.prototype,XF.Events);_.extend(XF.Model.prototype,{dataURL:null,dataRequestSettings:null,isEmptyData:false,isStaticData:false,isStringData:false,autoUpdateInterval:0,updateInBackground:false,updateOnShow:false,defaults:null,get:function(C){return this.attributes[C]},has:function(C){return this.attributes[C]!=null},set:function(F,E){E||(E={});if(!F){return this}if(F.attributes){F=F.attributes}var D=this.attributes,H=this._escapedAttributes;if(this.idAttribute in F){this.id=F[this.idAttribute]}var G=this._changing;this._changing=true;for(var C in F){var I=F[C];if(!_.isEqual(D[C],I)){D[C]=I;this._changed=true;if(!E.silent){this.trigger("change:"+C,this,I,E)}}}if(this._changed&&!E.silent){this.trigger("changed")}if(!G&&!E.silent&&this._changed){this.change(E)}this._changing=false;return this},unset:function(C,D){if(!(C in this.attributes)){return this}D||(D={});var E=this.attributes[C];delete this.attributes[C];if(C==this.idAttribute){delete this.id}this._changed=true;if(!D.silent){this.trigger("change:"+C,this,void 0,D);this.change(D)}return this},clear:function(E){E||(E={});var C;var D=this.attributes;this.attributes={};this._changed=true;if(!E.silent){for(C in D){this.trigger("change:"+C,this,void 0,E)}this.change(E)}return this},change:function(C){this.trigger("change",this,C);this._previousAttributes=_.clone(this.attributes);this._changed=false},hasChanged:function(C){if(C){return this._previousAttributes[C]!=this.attributes[C]}return this._changed},changedAttributes:function(E){E||(E=this.attributes);var D=this._previousAttributes;var F=false;for(var C in E){if(!_.isEqual(D[C],E[C])){F=F||{};F[C]=E[C]}}return F},previous:function(C){if(!C||!this._previousAttributes){return null}return this._previousAttributes[C]},previousAttributes:function(){return _.clone(this._previousAttributes)},construct:function(){this.init();this.trigger("init");if(this.autoUpdateInterval>0){var C=_.bind(function(){if($(this.component.selector()).is(":visible")){this.refresh()}else{if(this.updateInBackground){this.refresh()}}},this);setInterval(C,this.autoUpdateInterval)}if(this.updateOnShow){$(this.component.selector()).bind("show",_.bind(this.refresh,this))}this.trigger("construct")},init:function(){},refresh:function(){var C=function(){this.unbind("dataLoaded",C);var D=this.component.view.renderVersion;this.afterLoadData();this.trigger("refresh")};this.bind("dataLoaded",C);this.beforeLoadData();this.loadData()},getDataURL:function(){if(!this.dataURL){if(!this.component){throw'XF.Model "component" linkage lost'}this.dataURL=XF.Settings.property("dataUrlFormatter")(this.component.name)}return this.dataURL},getDataRequestSettings:function(){return this.dataRequestSettings||{}},beforeLoadData:function(){},loadData:function(){if(!this.isEmptyData&&(!this.rawData||!this.isStaticData||this.autoUpdate>0)){var D=this;var C=this.getDataURL();$.ajax(C,_.extend(this.getDataRequestSettings(),{complete:function(E,F){if(!D.component){throw'XF.Model "component" linkage lost'}if(F=="success"){if(D.isStringData){D.rawData=E.responseText}else{D.rawData=$.parseJSON(E.responseText)}}else{if(D.isStringData){D.rawData={}}else{D.rawData=""}}D.trigger("dataLoaded")}}))}else{this.trigger("dataLoaded")}},afterLoadData:function(){}},{});XF.Model.extend=x;XF.View=function(){};XF.View.getMarkup=function(){if(!this.component.constructor.compiledTemplate){this.component.constructor.compiledTemplate=_.template(this.component.constructor.template)}return this.component.constructor.compiledTemplate(this.component.model)};_.extend(XF.View.prototype,XF.Events);_.extend(XF.View.prototype,{component:null,templateURL:null,ignoreModelUpdate:false,updateOnShow:false,useCache:false,construct:function(){var C=function(){if(this.loadTemplateFailed){this.unbind("templateLoaded",C);this.afterLoadTemplateFailed();return}if(!this.component.constructor.templateLoaded){this.loadTemplate();return}this.unbind("templateLoaded",C);this.afterLoadTemplate();this.getMarkup=_.bind(XF.View.getMarkup,this);this.init();this.trigger("init");if(!this.ignoreModelUpdate){this.component.model.bind("changed",this.refresh,this)}if(this.updateOnShow){$(this.component.selector()).bind("show",_.bind(this.refresh,this))}this.trigger("construct")};this.bind("templateLoaded",C);this.beforeLoadTemplate();this.loadTemplate()},lastDeviceType:null,getTemplateURL:function(){if(this.lastDeviceType){this.templateURL=null}if(!this.templateURL){if(!this.component){throw'XF.View "component" linkage lost'}this.lastDeviceType=XF.Device.getNextType(this.lastDeviceType);if(!this.lastDeviceType){return null}var C="";if(this.lastDeviceType&&this.lastDeviceType.templatePath){C=this.lastDeviceType.templatePath}this.templateURL=XF.Settings.property("templateUrlFormatter")(this.component.name,C)}return this.templateURL},beforeLoadTemplate:function(){},loadTemplateFailed:false,loadTemplate:function(){var C=this.getTemplateURL();if(C==null){this.loadTemplateFailed=true;this.trigger("templateLoaded");return}if(this.useCache){var D=XF.Cache.get(C);if(D){this.component.constructor.template=D;this.component.constructor.templateLoaded=true;this.trigger("templateLoaded");return}}if(!this.component.constructor.templateLoaded&&!this.component.constructor.templateLoading){this.component.constructor.templateURL=C;this.component.constructor.templateLoading=true;var E=this;$.ajax(C,{complete:function(H,I){if(!E.component){throw'XF.View "component" linkage lost'}if(I=="success"){var G=H.responseText;if(E.useCache){XF.Cache.set(C,G)}E.component.constructor.template=H.responseText;E.component.constructor.templateLoading=false;E.component.constructor.templateLoaded=true;E.trigger("templateLoaded");XF.Controller.trigger("templateLoaded",{url:C,template:G})}else{E.component.constructor.template=null;E.component.constructor.templateLoading=false;E.component.constructor.templateLoaded=false;E.trigger("templateLoaded");XF.Controller.trigger("templateLoaded",{url:C,template:null})}}})}else{if(this.component.constructor.templateLoading){var E=this;C=this.component.constructor.templateURL;var F=function(G){if(G.url==C){XF.Controller.unbind("templateLoaded",F);E.trigger("templateLoaded")}};XF.Controller.bind("templateLoaded",F)}else{this.trigger("templateLoaded")}}},afterLoadTemplate:function(){},afterLoadTemplateFailed:function(){console.log('XF.View :: afterLoadTemplateFailed - could not load template for "'+this.component.id+'"');console.log("XF.View :: afterLoadTemplateFailed - @dev: verify XF.Device.types settings & XF.View :: getTemplate URL overrides")},init:function(){},refresh:function(){this.preRender();this.render();this.postRender();this.trigger("refresh")},preRender:function(){},renderVersion:0,render:function(){this.renderVersion++;var C=$("[data-id="+this.component.id+"]");C.html(this.getMarkup());z(C)},postRender:function(){}});XF.View.extend=x;XF.RootComponentInstance=null;XF.RootComponent=XF.Component.extend({beforeStart:function(){},start:function(){XF.Router.start();XF.PageSwitcher.start()},afterStart:function(){},constructor:function(C,D){if(XF.RootComponentInstance){throw"XF.RootComponent can be only ONE!"}XF.RootComponentInstance=this;this.ready(function(){XF.RootComponentInstance.beforeStart();XF.RootComponentInstance.start();XF.RootComponentInstance.afterStart()});XF.Component.apply(this,arguments)}});XF.PageSwitcher=null;XF.PageSwitcherClass=function(){};_.extend(XF.PageSwitcherClass.prototype,{pageClass:"xf-page",activePageClass:"xf-page-active",animationType:"fade",activePage:null,start:function(){$.fn.animationComplete=function(E){if("WebKitTransitionEvent" in j||"transitionEvent" in j){return $(this).one("webkitAnimationEnd animationend",E)}else{setTimeout(E,0);return $(this)}};var C=$(XF.RootComponentInstance.selector()+" ."+this.pageClass);if(C.length){var D=C.filter("."+this.activePageClass);if(D.length){this.activePage=D}else{this.switchToPage(C.first())}XF.Router.bindAnyRoute(this.routeHandler)}},routeHandler:function(D){var C=XF.Router.getRouteByEventName(D);var E=$("."+XF.PageSwitcher.pageClass+"#"+C);if(E.length){XF.PageSwitcher.switchToPage(E)}},switchToPage:function(F){if(this.activePage&&F.attr("id")==this.activePage.attr("id")){return}var C=XF.Device.getViewport();var I=XF.Device.getScreenHeight();var D=this.animationType;var H=this.activePageClass;var G=this.activePage;var E=F;this.activePage=E;if(G){C.addClass("xf-viewport-transitioning");G.height(I+$(j).scrollTop()).addClass("out "+D);E.height(I+$(j).scrollTop()).addClass("in "+D+" "+H);G.animationComplete(function(J){G.height("").removeClass(D+" out in reverse");if(G.attr("id")!=XF.PageSwitcher.activePage.attr("id")){G.removeClass(H)}});E.animationComplete(function(J){E.height("").removeClass(D+" out in reverse");C.removeClass("xf-viewport-transitioning")})}else{this.activePage.addClass(H)}j.scrollTo(0,1);z(this.activePage[0])}});$.fn.touchable=function(C){return this.each(function(){if(!$(this).data("touchable")){$(this).data("touchable",new XF.Touchable(this,C))}return $(this).data("touchable")})};XF.TouchGesture=function(C,E,D){this.touchable=C;this.fingerID=E;this.startPosition=D;this.currentPosition=D;this.previousPosition=D;this.previousDelta={x:0,y:0};this.startDelta={x:0,y:0};this.swipeAngle=0;this.swipeLength=0;this.swipeDirection=XF.TouchGesture.SWIPE_DIRECTION_LEFT;this.longTouchHandler=_.bind(this.longTouchHandlerF,this);this.longTouchTimeout=setTimeout(this.longTouchHandler,this.touchable.options.longTapInterval);this.longTouchDispatched=false;this.gestureComplete=false;this.dispatch(XF.TouchGesture.TOUCH_START_EVENT)};_.extend(XF.TouchGesture.prototype,{move:function(C){this.previousPosition=this.currentPosition;this.currentPosition=C;this.previousDelta.x=this.currentPosition.x-this.previousPosition.x;this.previousDelta.y=this.currentPosition.y-this.previousPosition.y;this.startDelta.x=this.currentPosition.x-this.startPosition.x;this.startDelta.y=this.currentPosition.y-this.startPosition.y;this.checkSwipe();this.dispatch(XF.TouchGesture.TOUCH_MOVE_EVENT)},checkSwipe:function(){this.swipeLength=Math.round(Math.sqrt(Math.pow(this.startDelta.x,2)+Math.pow(this.startDelta.y,2)));if(this.swipeLength>this.touchable.options.swipeLength){var C=Math.atan2(this.startDelta.y,this.startDelta.x);this.swipeAngle=Math.round(C*180/Math.PI);if(this.swipeAngle<0){this.swipeAngle=360-Math.abs(this.swipeAngle)}if((this.swipeAngle<=45)&&(this.swipeAngle>=0)){this.swipeDirection=XF.TouchGesture.SWIPE_DIRECTION_RIGHT}else{if((this.swipeAngle<=360)&&(this.swipeAngle>=315)){this.swipeDirection=XF.TouchGesture.SWIPE_DIRECTION_RIGHT}else{if((this.swipeAngle>=135)&&(this.swipeAngle<=225)){this.swipeDirection=XF.TouchGesture.SWIPE_DIRECTION_LEFT}else{if((this.swipeAngle>45)&&(this.swipeAngle<135)){this.swipeDirection=XF.TouchGesture.SWIPE_DIRECTION_DOWN}else{this.swipeDirection=XF.TouchGesture.SWIPE_DIRECTION_UP}}}}this.dispatch(XF.TouchGesture.SWIPE_EVENT);this.touchable.destroyGesture(this.fingerID)}},longTouchHandlerF:function(){this.dispatch(XF.TouchGesture.LONG_TAP_EVENT);this.longTouchDispatched=true},release:function(){if(!this.gestureComplete){if(!this.longTouchDispatched){clearTimeout(this.longTouchTimeout);this.dispatch(XF.TouchGesture.TAP_EVENT);if(this.touchable.lastTapTimestamp+this.touchable.options.doubleTapInterval>XF.TouchGesture.getTimeStamp()){this.dispatch(XF.TouchGesture.DOUBLE_TAP_EVENT);this.touchable.lastTapTimestamp=0}else{this.touchable.lastTapTimestamp=XF.TouchGesture.getTimeStamp()}}}this.gestureComplete=true;this.dispatch(XF.TouchGesture.TOUCH_END_EVENT);this.touchable.destroyGesture(this.fingerID)},dispatch:function(C){console.log("XF.TouchGesture :: dispatch - "+C+" ("+this.fingerID+")");$(this.touchable.elem).trigger(C,this)}});_.extend(XF.TouchGesture,{TOUCH_START_EVENT:"TOUCH_START",TOUCH_MOVE_EVENT:"TOUCH_MOVE",TOUCH_END_EVENT:"TOUCH_END",TAP_EVENT:"TAP",SWIPE_EVENT:"SWIPE",LONG_TAP_EVENT:"LONG_TAP",DOUBLE_TAP_EVENT:"DOUBLE_TAP",SWIPE_DIRECTION_LEFT:"LEFT",SWIPE_DIRECTION_RIGHT:"RIGHT",SWIPE_DIRECTION_UP:"UP",SWIPE_DIRECTION_DOWN:"DOWN",getTimeStamp:function(){return new Date().getTime()}});XF.Touchable=function(D,C){this.elem=D;this.$elem=$(D);if(C){this.options=_.clone(C)}else{this.options={}}_.defaults(this.options,{swipeLength:XF.Settings.property("touchableSwipeLength"),doubleTapInterval:XF.Settings.property("touchableDoubleTapInterval"),longTapInterval:XF.Settings.property("touchableLongTapInterval")});this.gestures={};this.lastTapTimestamp=0;this.touchstart=_.bind(this.touchstartF,this);this.touchmove=_.bind(this.touchmoveF,this);this.touchend=_.bind(this.touchendF,this);if(XF.Device.isTouchable){$(D).bind("touchstart",this.touchstart)}else{$(D).bind("mousedown",this.touchstart)}};_.extend(XF.Touchable.prototype,{getGestureByID:function(C){return this.gestures[C]},createGesture:function(D,C){return this.gestures[D]=new XF.TouchGesture(this,D,C)},destroyGesture:function(C){delete this.gestures[C];if(_.size(this.gestures)==0){if(XF.Device.isTouchable){$(document).unbind("touchmove",this.touchmove);$(document).unbind("touchend",this.touchend)}else{$(document).unbind("mousemove",this.touchmove);$(document).unbind("mouseup",this.touchend)}}},touchstartF:function(D){D=D.originalEvent||D;if(D.changedTouches!=undefined){var C=this;_.each(D.changedTouches,function(F,E){C.createGesture(F.identifier,{x:F.clientX,y:F.clientY})});$(document).bind("touchmove",this.touchmove);$(document).bind("touchend",this.touchend)}else{this.createGesture("mouse",{x:D.pageX,y:D.pageY});$(document).bind("mousemove",this.touchmove);$(document).bind("mouseup",this.touchend)}},touchmoveF:function(E){E=E.originalEvent||E;if(E.changedTouches!=undefined){var C=this;_.each(E.changedTouches,function(H,F){var G=C.getGestureByID(H.identifier);if(G){G.move({x:H.clientX,y:H.clientY})}})}else{var D=this.getGestureByID("mouse");if(D){D.move({x:E.pageX,y:E.pageY})}}},touchendF:function(E){E=E.originalEvent||E;if(typeof E.changedTouches!=="undefined"){var C=this;_.each(E.changedTouches,function(H,F){var G=C.getGestureByID(H.identifier);if(G){G.release()}})}else{var D=this.getGestureByID("mouse");if(D){D.release()}}}});XF.Device=null;XF.DeviceClass=function(){this.size={width:0,height:0};this.types=[{name:"desktop",range:{max:null,min:1024},templatePath:"desktop/",fallBackTo:"tablet"},{name:"tablet",range:{max:1024,min:480},templatePath:"tablet/",fallBackTo:"mobile"},{name:"mobile",range:{max:480,min:null},templatePath:"mobile/",fallBackTo:"default"}];this.defaultType={name:"default",range:{min:null,max:null},templatePath:"",fallBackTo:null};this.type=this.defaultType;this.isTouchable=false};_.extend(XF.DeviceClass.prototype,{init:function(C){this.types=C||this.types;this.detectType();this.detectTouchable()},detectType:function(){this.size.width=$(j).width();this.size.height=$(j).height();console.log('XF.DeviceClass :: detectType - width = "'+this.size.width+'"');console.log('XF.DeviceClass :: detectType - height = "'+this.size.height+'"');var D=Math.max(this.size.width,this.size.height);console.log('XF.DeviceClass :: detectType - maxSide = "'+D+'"');var C=null;_.each(this.types,function(E){try{if((!E.range.min||(E.range.min&&D>E.range.min))&&(!E.range.max||(E.range.max&&D<E.range.max))){C=E}}catch(F){console.log("XF.DeviceClass :: detectType - bad type detected - skipping");console.log("XF.DeviceClass :: detectType - @dev: plz verify types list")}});if(C){this.type=C}else{this.type=this.defaultType;console.log("XF.DeviceClass :: detectType - could not choose any of device type");console.log("XF.DeviceClass :: detectType - drop back to this.defaultType");console.log("XF.DeviceClass :: detectType - @dev: plz verify types list")}console.log('XF.DeviceClass :: detectType - selected type "'+this.type.name+'"')},getNextType:function(D){var C=this.type;if(D){if(D.fallBackTo){C=this.getTypeByName(D.fallBackTo)}else{C=this.defaultType}}if(C&&C.templatePath){}else{C=this.defaultType}if(C==D){console.log("XF.DeviceClass :: getNextType - infinit cycle of drop down logic detected");console.log("XF.DeviceClass :: getNextType - stop trying, no template is available");return null}return C},getTypeByName:function(C){var D=null;_.each(this.types,function(E){try{if(E.name==C){D=E}}catch(F){console.log("XF.DeviceClass :: getTypeByName - bad type name - skipping");console.log("XF.DeviceClass :: getTypeByName - @dev: plz verify types list")}});return D},detectTouchable:function(){var D=" -webkit- -moz- -o- -ms- ".split(" ");var C=["@media (",D.join("touch-enabled),("),"app_device_test",")","{#touch{top:9px;position:absolute}}"].join("");var E=this;this.injectElementWithStyles(C,function(J,K){var I=document.styleSheets[document.styleSheets.length-1],H=I?(I.cssRules&&I.cssRules[0]?I.cssRules[0].cssText:I.cssText||""):"",G=J.childNodes,F=G[0];E.isTouchable=("ontouchstart" in j)||j.DocumentTouch&&document instanceof DocumentTouch||(F&&F.offsetTop)===9},1,["touch"]);console.log("XF.Device :: detectTouchable - device IS "+(this.isTouchable?"":"NOT ")+"touchable")},injectElementWithStyles:function(J,L,E,K){var D,I,G,C=document.createElement("div"),H=document.body,F=H?H:document.createElement("body");if(parseInt(E,10)){while(E--){G=document.createElement("div");G.id=K?K[E]:"app_device_test"+(E+1);C.appendChild(G)}}D=["&#173;","<style>",J,"</style>"].join("");C.id="app_device_test";F.innerHTML+=D;F.appendChild(C);if(!H){F.style.background="";docElement.appendChild(F)}I=L(C,J);!H?F.parentNode.removeChild(F):C.parentNode.removeChild(C);return !!I},ORIENTATION_PORTRAIT:"portrait",ORIENTATION_LANDSCAPE:"landscape",getOrientation:function(){var D=true,C=document.documentElement;if($.support.orientation){D=portrait_map[j.orientation]}else{D=C&&C.clientWidth/C.clientHeight<1.1}return D?this.ORIENTATION_PORTRAIT:this.ORIENTATION_LANDSCAPE},getScreenHeight:function(){var E=this.getOrientation();var D=E===this.ORIENTATION_PORTRAIT;var F=D?480:320;var H=D?screen.availHeight:screen.availWidth;var C=Math.max(F,$(j).height());var G=Math.min(H,C);return G},getViewport:function(){var C=$("body").addClass("xf-viewport");if(!C[0]){C=$(".xf-page").eq(0);if(!C.length){C=$("body")}else{C=C.parent()}C.addClass("xf-viewport")}return C.eq(0)}});XF.trace=function(C){$("#tracer").html(C+"<br/>"+$("#tracer").html())};j.XF=XF}).call(this,window);